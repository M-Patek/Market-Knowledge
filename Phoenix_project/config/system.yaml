# Phoenix Project 核心系统配置
# 详细的 schema 见 core/schemas/config_schema.py

system:
  environment: "development" # "development" (回测) 或 "production" (实时/虚拟交易)
  max_pipeline_history: 100 # PipelineState 中保留的最大周期数
  data_catalog_path: "data_catalog.json"
  log_level: "INFO" # 从旧版本合并

# [从旧版本合并] Pipeline 核心设置
pipeline:
  K_paths: 5
  conflict_threshold: 0.6
  uncertainty_threshold: 0.4
  auto_retry: 3
  audit_log_retention_days: 30
  fact_check_threshold: 0.7
  fc_confidence_boost: 0.1
  fc_confidence_penalty: 0.2
  cot_log_retention_days: 14     # [主人喵的清洁计划 4.1]
  snapshot_retention_days: 7  # [主人喵的清洁计划 4.1]
  vector_retention_days: 90   # [主人喵的清洁计划 4.1] (为 Janitor 添加一个默认值)

# [阶段 3 & 4 新增：券商配置]
broker:
  type: "alpaca" # 匹配 adapters.py 中的逻辑
  api_key_env: "ALPACA_API_KEY" # 告诉代码从 .env 中读取哪个变量
  api_secret_env: "ALPACA_API_SECRET" # 告诉代码从 .env 中读取哪个变量
  base_url: "https://paper-api.alpaca.markets" # 确保这是虚拟交易 (Paper) 的 URL

# AI 和 RAG 配置
ai:
  # [从旧版本合并]
  ai_providers:
    google:
      api_key_env_var: "GEMINI_API_KEYS" # <--- [✅ 修复] 与 .env.example (Source 2) 保持一致
      models:
        - name: "gemini-2.5-pro"
          type: "generative"
        - name: "text-embedding-004"
          type: "embedding"

  # [合并]
  embedding_client:
    provider: "google" # 从旧版本合并
    model: "text-embedding-004" # 您的最新设置
    batch_size: 100 # 从旧版本合并

  # [您的最新设置]
  vector_database:
    provider: "pinecone" # "pinecone" 或 "faiss"
    index_name: "phoenix-project-rag" # 从旧版本合并 (假设)
    embedding_dimension: 768 # 从旧版本合并 (假设)
    # faiss_path: "/path/to/faiss.index"

  # [您的最新设置 - 已修复]
  cot_database:
    # CoT (Chain of Thought) 数据库配置
    provider: "elasticsearch"
    host: "phoenix_elastic" # [✅ 修复] "localhost" -> "phoenix_elastic" (Docker 服务名)
    port: 9200
    index: "phoenix-cot-traces" # [主人喵的清洁计划] 明确指定索引

  # [从旧版本合并] RAG 检索器和重排
  retriever:
    rrf_k: 60
    freshness_decay_rate: 0.05
    source_type_weights:
      "10-K": 1.0
      "10-Q": 0.9
      "Press Release": 0.8
      "News": 0.7
      "Analyst Report": 0.6
      "Market Data": 0.9
      "Other": 0.5
    rerank:
      model: "cross-encoder/ms-marco-MiniLM-L-6-v2"
      top_n: 10 
      
  # [从旧版本合并] AI 推理
  reasoning_ensemble:
    meta_learner:
      n_timesteps: 5
      n_features: 16
    loss_function:
      beta_nll_weight: 0.5
      focal_loss_gamma: 2.0
    adversarial_training:
      enabled: true
      epsilon: 0.02
    reasoners:
      - name: "SymbolicLogicReasoner"
        class: "ai.reasoning_ensemble.SymbolicLogicReasoner"
        enabled: true
        config:
          rules_path: "config/symbolic_rules.yaml"
      - name: "BayesianBeliefNetworkReasoner"
        class: "ai.reasoning_ensemble.BayesianBeliefNetworkReasoner"
        enabled: true
      - name: "LLMExplainerReasoner"
        class: "ai.reasoning_ensemble.LLMExplainerReasoner"
        enabled: true
      - name: "DeepForestReasoner"
        class: "ai.reasoning_ensemble.DeepForestReasoner"
        enabled: true

# --- [任务 1: 新增 L3 DRL 智能体配置] ---
# 为 RLLib "心脏移植" 添加配置
l3_agents:
  alpha_agent:
    # 路径指向 RLLib 检查点目录, 而不是旧的 .zip 文件
    model_path: "models/drl_agents_v1_rllib/alpha/checkpoint_000100"
  risk_agent:
    model_path: "models/drl_agents_v1_rllib/risk/checkpoint_000100"
  execution_agent:
    model_path: "models/drl_agents_v1_rllib/exec/checkpoint_000100"
# --- [任务 1 结束] ---

# [主人喵的清洁计划] 为 AuditLogger 添加专用配置 (Janitor 需要)
audit_db:
  provider: "elasticsearch"
  host: "phoenix_elastic"
  port: 9200
  index: "phoenix-audit-logs" # [主人喵的清洁计划] 明确指定索引
    
# 数据库 (KG) - [您的最新设置 - 已修复]
neo4j_db:
  uri: "bolt://phoenix_neo4j:7687" # [✅ 修复] "localhost" -> "phoenix_neo4j" (Docker 服务名)
  user: "neo4j"
  password_env: "NEO4J_PASSWORD"

# (其他数据库...) - [您的最新设置]
tabular_db:
  provider: "postgres"
  uri_env: "TABULAR_DB_URI" # (在 Docker 中, .env 应设为 "postgresql://user:pass@phoenix_postgres:5432/db")
  
# 数据库 (Temporal - 时序事件) - [✅ 修复] 与 RAG 架构和代码实现 (temporal_db_client.py) 保持一致
temporal_db:
  provider: "elasticsearch"
  host: "phoenix_elastic"     # [✅ 修复] "localhost" -> "phoenix_elastic" (Docker 服务名)
  port: 9200
  index_name: "phoenix-temporal-events" # [✅ 修复] 明确指定索引名称 (与 RAG 架构对应)

# 交易和投资组合 - [您的最新设置]
trading:
  initial_cash: 1000000.0 # 回测/模拟账户的初始资金
  
portfolio:
  sizer:
    type: "FixedFractionSizer" # "FixedFractionSizer" 或 "VolatilityParitySizer"
    params:
      fraction_per_position: 0.05 # 适用于 FixedFractionSizer
      # volatility_period: 20 # 适用于 VolatilityParitySizer

# 错误处理 - [您的最新设置]
error_handler:
  max_retries: 3
  retry_delay_seconds: 60

# [主人喵的最终优化] 已移除 'jobs:' 部分，因为它已被 worker.py 中的 Celery Beat 调度替代。
