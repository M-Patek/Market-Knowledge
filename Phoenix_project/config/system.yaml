# Phoenix_project/config/system.yaml
# Global configuration for the Phoenix Project AI system

# System-wide settings
system:
  environment: "development" # "production" or "development"
  log_level: "INFO"

# Pipeline settings from Task 20
pipeline:
  K_paths: 5
  conflict_threshold: 0.6
  uncertainty_threshold: 0.4
  auto_retry: 3
  audit_log_retention_days: 30
  
ai:
  # 1. AI Client Providers (from config/ai_clients.yaml)
  ai_providers:
    google:
      api_key_env_var: "GEMINI_PRO_KEY"
      models:
        # 修正：根据主人的决定，将推理模型更新为 gemini-2.5-pro
        - name: "gemini-2.5-pro"
          type: "generative"
        # 修正：根据主人的决定，嵌入模型为 text-embedding-004 (已正确)
        - name: "text-embedding-004"
          type: "embedding"
  
  # 2. Embedding Client Configuration (from config/ai_clients.yaml)
  embedding_client:
    provider: "google"
    model: "text-embedding-004"
    batch_size: 100
    
  # 3. Vector Database Configuration (from config/ai_clients.yaml)
  vector_database:
    index_name: "phoenix-project-rag"
    embedding_dimension: 768
  
  # 4. Hybrid Retriever & Re-ranking Settings (from config/ai_clients.yaml)
  retriever:
    rrf_k: 60
    freshness_decay_rate: 0.05
    source_type_weights:
      "10-K": 1.0
      "10-Q": 0.9
      "Press Release": 0.8
      "News": 0.7
      "Analyst Report": 0.6
      "Market Data": 0.9
      "Other": 0.5
      
    # 修复：基于 Phoenix_project.md (V2.0) 文档中的明确引用
    # "第二阶段使用 Cross-Encoder (cross-encoder/ms-marco-MiniLM-L-6-v2) 进行深度语义重排。"
    rerank:
      model: "cross-encoder/ms-marco-MiniLM-L-6-v2"
      top_n: 10 # 这是一个合理的默认值
      
  # 5. Reasoning Ensemble (from ai/model_config.yaml)
  reasoning_ensemble:
    meta_learner:
      n_timesteps: 5
      n_features: 16
    loss_function:
      beta_nll_weight: 0.5
      focal_loss_gamma: 2.0
    adversarial_training:
      enabled: true
      epsilon: 0.02
    reasoners:
      - name: "SymbolicLogicReasoner"
        class: "ai.reasoning_ensemble.SymbolicLogicReasoner"
        enabled: true
        config:
          rules_path: "config/symbolic_rules.yaml"
      - name: "BayesianBeliefNetworkReasoner"
        class: "ai.reasoning_ensemble.BayesianBeliefNetworkReasoner"
        enabled: true
      - name: "LLMExplainerReasoner"
        class: "ai.reasoning_ensemble.LLMExplainerReasoner"
        enabled: true
      - name: "DeepForestReasoner"
        class: "ai.reasoning_ensemble.DeepForestReasoner"
        enabled: true

# 修复：基于 RAG_ARCHITECTURE.md 文档的推断
# "Technology: Elasticsearch"
# FIX (E-CONFIG-1): 将 'localhost' 更改为 Docker 服务名 'elasticsearch'
temporal_db:
  host: "elasticsearch"
  port: 9200
  index: "phoenix-temporal"

# 修复：基于 RAG_ARCHITECTURE.md 文档的推断
# "Technology: PostgreSQL"
# FIX (E-CONFIG-1): 将 'localhost' 更改为 Docker 服务名 'postgres_db'
tabular_db:
  host: "postgres_db"
  port: 5432
  user: "phoenix_user"
  # FIX: 修复了密码逻辑断裂
  # 将 'PG_PASSWORD' 更改为 'POSTGRES_PASSWORD' 以匹配 docker-compose.yml
  password_env_var: "POSTGRES_PASSWORD"
  database: "phoenix_tabular"
