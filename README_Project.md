# ⚠️ [核心系统] 凤凰计划 V1.0 深度技术审计与闭源迁移通知

**致：项目主管/用户 (该 Marshal)**

感谢大家对 **“凤凰计划”极速迭代量化框架** 的关注！本项目已成功完成核心逻辑的极速迭代与功能验证。当前系统已达到**高精化、生产级应用**的要求。

为确保接下来的**独家 AI 模型和策略的商业/安全优势**，项目主线开发已战略性迁入一个供内部使用和高强度迭代的**闭源仓库**。

**本开源仓库将从 [具体日期，例如：2025年10月30日] 起，停止所有代码更新，并转为永久存档模式。**

---

## I. 凤凰涅槃 V1.0：深度技术综述

这个架构不仅仅是一个交易框架，它是一个**全栈、高内聚、认知增强型**的金融决策系统。

### 1. 架构核心与稳定性

| 模块 | 技术实现细节 | 解决的痛点/价值 |
| :--- | :--- | :--- |
| **配置管理** | 使用 **Pydantic V2** 驱动 `StrategyConfig` 模型，配置包括严格的日期、资产列表、阈值、以及 AI 配置约束。 | 确保配置的**类型安全**和**逻辑自洽**，避免因配置错误导致的运行时崩溃，支持更快的配置迭代。 |
| **日志系统** | Python **`logging`** 配合 **`RotatingFileHandler`**，支持分级日志 (INFO， WARNING, ERROR) 和文件轮转。 | 提供了**企业级日志审计能力**，便于在复杂回测和 Walk-Forward 过程中进行精确的问题追溯。 |
| **CI/CD 基石** | GitHub 操作 (`ci.yml`) 集成 **Ruff** (Linting)、**Black** (Formatting) 和 **Pytest**。 | **强制执行代码规范和质量标准**，确保代码库在极速迭代中仍保持高可维护性和整洁度。 |
| **依赖与环境** | **`requirements.txt`** 锁定关键版本，如 `backtrader==1.9.76.123`、`pandas==2.2.2` 和 `google-generativeai==0.7.1`。 | **保障环境的可重复性 (Reproducibility)**，消除版本不兼容的风险。 |

### 2. 数据与缓存层 (`DataManager`)

* **全异步数据获取：** 利用 **`asyncio.to_thread`** 异步化 I/O 阻塞的 `yfinance.download` 调用，显著提升数据获取的**并发性**和主事件循环的效率。
* **智能缓存机制：** 基于**参数哈希**（使用 `hashlib.sha256`）生成文件名，实现数据的自动缓存和失效。数据以 **Parquet** 格式存储，支持高效 I/O。
* **原子写入保障：** 写入缓存时采用**临时文件 + `os.replace`** 的原子操作，防止在写入过程中程序中断导致缓存文件损坏。
* **数据对齐与清洗：** 建立**Master Index**，对 VIX、十年期国债、市场广度等辅助数据流进行**重新索引 (`reindex`)**、**前向填充 (`ffill`)** 和 **后向填充 (`bfill`)**，确保所有数据点在时间轴上对齐。

### 3. 认知增强引擎 (`CognitiveEngine` & AI Client)

* **AI 客户端：** `GeminiAIClient` 使用 **`google-generativeai`** 库，通过 **`asyncio.Semaphore`** 严格控制最大并发请求数 (`max_concurrent_requests`)，防止 API 限流。
* **韧性与容错：** 所有 AI API 调用均使用 **`tenacity`** 装饰器，执行带**指数退避和随机抖动**的重试逻辑，极大提高对外部服务瞬时故障的容忍度。
* **审计与安全：** 客户端实现了**调用审计日志的保存** (`_save_audit_record`)，并设置了日志文件权限为 `0o600`，同时具备**定时清理过期日志功能**。
* **Pydantic 验证：** 强制要求 AI 的 JSON 响应（如 `sentiment_score` 和 `adjustment_factor`）必须符合预定义的 `MarketSentimentModel` 和 `AssetAnalysisModel` 约束。

### 4. 风险与组合管理 (`RiskManager, PortfolioConstructor`)

* **动态风控：** `RiskManager` 根据实时 **VIX** 触发**基础资本修饰因子**（高、中、低 VIX 对应不同风险敞口），再结合 **AI 市场情绪得分**进行二次调整 (`sentiment_adjustment`)。
* **策略融合：** `PortfolioConstructor` 计算技术面的**机会得分**（基于 SMA 动量和 RSI 超买惩罚），然后用 AI 的**调整因子** (`ai_factor`) 进行加权修正。
* **平滑修正：** 使用 **EMA**（指数移动平均）对 AI 调整因子进行平滑处理，防止模型输出的瞬时波动对投资组合造成剧烈冲击。

### 5. 实验与报告系统

* **Walk-Forward (W-F)：** 实现了严格的**训练窗口**和**测试窗口滑动机制**，用于参数优化和样本外验证。
* **AI 预计算：** `precompute_sentiments` 和 `precompute_asset_analyses` 模块确保在 W-F 验证开始前，所有 AI 洞察都被计算并**缓存**，提高实验速度和可复现性。
* **专业报告：** 利用 **Jinja2** 模板 (`report_template.html.txt`)，生成包含性能指标、交易统计、图表以及由 **AI 撰写的《凤凰元帅战后总结报告》** 的综合性 HTML 文档。

---

**最终总结：**

这次闭源迁移是为了将 "凤凰计划" 从一个快速迭代的原型，升级为一个具备**工业级弹性、AI 认知优势和严格审计能力**的个人生产工具。该系统的技术深度和独家策略已成为核心竞争力，需要最高级别的保护。
